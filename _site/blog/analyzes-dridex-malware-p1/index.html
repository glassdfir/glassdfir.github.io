<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>My analysis of Dridex malware (Part One) &#8211; Half Full of Security</title>
<meta name="description" content="">
<meta name="keywords" content="">


<!-- Twitter Cards -->
<meta name="twitter:title" content="My analysis of Dridex malware (Part One)">
<meta name="twitter:description" content="">
<meta name="twitter:site" content="@GlassDFIR">
<meta name="twitter:creator" content="@GlassDFIR">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://jon.glass/images/site-logo.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="My analysis of Dridex malware (Part One)">
<meta property="og:description" content="">
<meta property="og:url" content="http://jon.glass/blog/analyzes-dridex-malware-p1/">
<meta property="og:site_name" content="Half Full of Security">





<link rel="canonical" href="http://jon.glass/blog/analyzes-dridex-malware-p1/">
<link href="http://jon.glass/feed.xml" type="application/atom+xml" rel="alternate" title="Half Full of Security Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://jon.glass/assets/css/main.css">
<!-- Webfonts -->
<script src="https://use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
  <script src="http://jon.glass/assets/js/vendor/html5shiv.min.js"></script>
  <script src="http://jon.glass/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://jon.glass/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>


<!-- MathJax -->
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://jon.glass/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://jon.glass/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://jon.glass/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://jon.glass/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://jon.glass/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://jon.glass/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
      
		    
		    <li><a href="http://jon.glass/blog/" >Blog</a></li>
		  
		    
		    <li><a href="http://jon.glass/courses/" >Courses</a></li>
		  
		    
		    <li><a href="http://jon.glass/TipsAndTricks/" >Tips and Tricks</a></li>
		  
		    
		    <li><a href="http://jon.glass/about/" >About</a></li>
		  
		    
		    <li><a href="http://jon.glass/search/" >Search</a></li>
		  
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<header class="masthead">
	<div class="wrap">
      
  		<a href="http://jon.glass/" class="site-logo" rel="home" title="Half Full of Security"><img src="http://jon.glass/images/site-logo.png" width="200" height="200" alt="Half Full of Security logo" class="animated fadeInDown"></a>
      
      <h1 class="site-title animated fadeIn"><a href="http://jon.glass/">Half Full of Security</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description">Sharpening the ACKs since 2013</h2>
	</div>
</header><!-- /.masthead -->

<div class="js-menu-screen menu-screen"></div>


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <ul class="entry-tags">
          
        </ul>
        
          <h1 class="entry-title">My analysis of Dridex malware (Part One)</h1>
        
      </header>


        <time datetime="2015-03-20T11:11:48-04:00"><i class="fa fa-calendar-o"></i> March 20, 2015</time>
        <p>I had a few unscripted hours to kill before bed so I snagged <a href="https://malwr.com/analysis/MzkzMTk3MzBlZGQ2NDRhY2IyNTc0MGI5MWQwNzEwZmQ/" target="_blank">a Dridex sample</a> from <a href="http://malwr.com" target="_blank">Malwr.com</a> to see what all of the fuss was about.

  According to <a href="https://threatpost.com/dridex-banking-trojan-spreading-via-office-macros/110255" target="_blank">ThreatPost</a>, Dridex is a descendent of <a href="https://threatpost.com/cridex-malware-takes-lesson-from-gameover-zeus/107785" target="_blank">Cridex, Feodo or Bugat and is in the GameOver Zeus family</a>. </p>
<p>File Name:064016.doc<br />
MD5: 8f6a30149bc8970e9233037533c044cd<br />
SHA1: 9515fbfb66624cb0684c32007f6b2a8b9e5756fc<br />
SHA256: f9b874f9ccf803abaeaaf7af93523ee140f1929837f267378c89ed7b5bf174</p>
<p>This file was tagged as Dridex but it looks like a malicious Word 2003 XML-based document. This is a first stage dropper for Dridex. Since it is an XML document, a plain-text format, it shouldn't be too hard to tear apart.<br />
First, I will start by running cat against the sample file to read the strings.<br />
<a href="https://jon.glass/wp-content/uploads/2015/03/Screen-Shot-2015-03-20-at-9.08.45-AM.png"><img src="/images/Screen-Shot-2015-03-20-at-9.08.45-AM-1024x731.png" alt="Screen Shot 2015-03-20 at 9.08.45 AM" width="780" height="557" class="aligncenter size-large wp-image-606" /></a><br />
There is a crap load of interesting metadata in here. Here are a few interesting tidbits:<br />
<script src="https://gist.github.com/glassdfir/76a8427cdfc825bb7ca5.js"></script><br />
So far we can tell that this Word 2003 document was created on 3/14/15, changed 6 times, last saved on 3/16/15. It was created on a Windows system running Office 2003 with the Russian language pack installed. There is also author and company names that can be helpful for setting up signatures. Those values are easily changed so while they are not definitive for attribution, they add context to the investigation. Finally, we can also tell that this document contains a macro. </p>
<p>To investigate this macro, I grabbed a copy of <a href="https://twitter.com/didierstevens">Didier Stevens'</a> <a href="http://blog.didierstevens.com/programs/oledump-py/">oledump.py</a>.</p>
<blockquote><p>oledump.py is a program to analyze OLE files (Compound File Binary Format). These files contain streams of data. oledump allows you to analyze these streams. Many applications use this file format, the best known is MS Office. .doc, .xls, .ppt, … are OLE files (docx, xlsx, … is the new file format: XML insize ZIP).</p></blockquote>
<p>So to get the lay of the land, I start with running oledump.py without any options:<br />
<strong>python oledump.py 064016.doc </strong><br />
<a href="https://jon.glass/wp-content/uploads/2015/03/Screen-Shot-2015-03-20-at-9.44.06-AM.png"><img src="/images/Screen-Shot-2015-03-20-at-9.44.06-AM-1024x562.png" alt="Screen Shot 2015-03-20 at 9.44.06 AM" width="780" height="428" class="alignleft size-large wp-image-610" /></a> From this we can see this Word doc contains an embedded file called editdata.mso which contains seven data streams. Three of the data streams are flagged as macros: A3:'VBA/Module1', A4:'VBA/Module2', A5:'VBA/ThisDocument'. Here is what these look like when dumped:<br />
<strong>python oledump.py 064016.doc -s A4 -v</strong><br />
<script src="https://gist.github.com/glassdfir/3cc052b5899992ac2f1e.js"></script><br />
As far as I can tell, VBA/Module2 does absolutely nothing. These are nonsensical functions designed to confuse heuristic scanners.<br />
<strong>python oledump.py 064016.doc -s A5 -v</strong><br />
<script src="https://gist.github.com/glassdfir/2ff987ad1ae5d2777205.js"></script><br />
This calls the HBjkbjBJKBL subroutine found in the A3 stream when the document is closed. This is an intentional technique used to evade sandbox analysis.<br />
<strong>python oledump.py 064016.doc -s A3 -v</strong><br />
<script src="https://gist.github.com/glassdfir/4085395fb7ac61d78afb.js"></script><br />
This is the payload. Can't see it? Looks like the payload was converted to hexadecimal to further obfuscate its intent. We will apply a little BashFu and ...<br />
<a href="https://jon.glass/wp-content/uploads/2015/03/Screen-Shot-2015-03-20-at-11.48.10-AM.png"><img src="/images/Screen-Shot-2015-03-20-at-11.48.10-AM-1024x429.png" alt="Screen Shot 2015-03-20 at 11.48.10 AM" width="780" height="327" class="alignleft size-large wp-image-615" /></a><br />
Voilà! We have our payload. Lets break these commands down:<br />
<script src="https://gist.github.com/glassdfir/ef374b97445cdb4a4ec3.js"></script><br />
You'll notice you don't see any of this in the Cuckoo report. This is because Cuckoo is looking for the infection to occur immediately after opening the document. This does nothing until you try to close it. Well played bad guys. Well played.</p>
<p>In my next post I will give you my run down of the assa.exe executable. Stay tuned.</p>

        

    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="http://jon.glass/blog/lists-some-wmic-commands/" class="btn" title="These Aren't Yo Momma's WMIC Commands">Previous</a>
      
      
        <a href="http://jon.glass/blog/analyzes-dridex-malware-p2/" class="btn" title="My analysis of Dridex malware (Part Two)">Next</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    

<span>&copy; 2018 Jon Glass. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/so-simple-jekyll-theme/" rel="nofollow">So Simple Theme</a>.</span>
<div class="social-icons">
	<a href="https://twitter.com/GlassDFIR" title="Jon Glass on Twitter" target="_blank"><i class="fa fa-twitter-square fa-2x"></i></a>
	
	
	
	
	
	
	<a href="https://github.com/GlassDFIR" title="Jon Glass on Github" target="_blank"><i class="fa fa-github-square fa-2x"></i></a>
	
  
	
  <a href="http://jon.glass/feed.xml" title="Atom/RSS feed"><i class="fa fa-rss-square fa-2x"></i></a>
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script type="text/javascript">
  var BASE_URL = 'http://jon.glass';
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://jon.glass/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://jon.glass/assets/js/scripts.min.js"></script>




</body>
</html>
